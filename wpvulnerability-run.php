<?php
/**
 * Running functions
 *
 * @package WPVulnerability
 * @version 2.0.0
 */
defined( 'ABSPATH' ) || die( 'No script kiddies please!' );

/**
 * Add Settings Link
 *
 * @param array $links links that appear in the plugin row.
 */
function wpvulnerability_add_settings_link( $links ) {

	$links[] = '<a href="' . get_admin_url( null, 'options-general.php?page=wpvulnerability-options' ) . '">' . __( 'Settings', 'wpvulnerability' ) . '</a>';
	return $links;

}
add_filter( 'plugin_action_links_' . WPVULNERABILITY_PLUGIN_BASE, 'wpvulnerability_add_settings_link' );

/**
 * On Activation
 * callback function for when the plugin is activated
 * add plugin data option if it isn't created already, schedule wp-cron job
 */
function wpvulnerability_activation() {

	if ( ! get_option( 'wpvulnerability-config' ) ) {
		add_option( 'wpvulnerability-config', array(
			'emails' => get_bloginfo( 'admin_email' ),
			'period' => 'weekly'
		) );
	}
	if ( ! get_option( 'wpvulnerability-plugins' ) ) {
		add_option( 'wpvulnerability-plugins', '' );
	}
	if ( ! get_option( 'wpvulnerability-plugins-cache' ) ) {
		add_option( 'wpvulnerability-plugins-cache', time() );
	}
	if ( ! get_option( 'wpvulnerability-themes' ) ) {
		add_option( 'wpvulnerability-themes', '' );
	}
	if ( ! get_option( 'wpvulnerability-themes-cache' ) ) {
		add_option( 'wpvulnerability-themes', time() );
	}
	if ( ! get_option( 'wpvulnerability-core' ) ) {
		add_option( 'wpvulnerability-core', '' );
	}
	if ( ! get_option( 'wpvulnerability-core-cache' ) ) {
		add_option( 'wpvulnerability-core', time() );
	}

	//wp_schedule_event( time(), 'twicedaily', 'wpvulnerability_pull_db_data_event' );

	//get_installed_plugins( );
	//get_installed_themes( );
	//get_installed_core( );

}
register_activation_hook( WPVULNERABILITY_PLUGIN_FILE, 'wpvulnerability_activation' );

/**
 * On Deactivation
 * callback function when a plugin is deactivated
 * delete, option and remove wp-cron job
 */
function wpvulnerability_deactivation() {

	delete_option( 'wpvulnerability_settings' );
	delete_option( 'wpvulnerability-data' );

	delete_option( 'wpvulnerability-themes' );
	delete_option( 'wpvulnerability-themes-cache' );
	delete_option( 'wpvulnerability-plugins' );
	delete_option( 'wpvulnerability-plugins-cache' );
	delete_option( 'wpvulnerability-core' );
	delete_option( 'wpvulnerability-core-cache' );

	//wp_clear_scheduled_hook( 'wpvulnerability_pull_db_data_event' );

}
register_deactivation_hook( WPVULNERABILITY_PLUGIN_FILE, 'wpvulnerability_deactivation' );









/**
 * Vulnerable Admin Notice
 * prints out error message if plugin(s) is/are vulnerable
 */
/*
function vulnerable_admin_notice() {
	sprintf(
		// translators: Dismissible message.
		'<div class="notice notice-error is-dismissible"><strong>%s</strong>: %s</div>',
		'WPVulnerability',
		__('There are possible vulnerabilities in your installation. Please, check your WordPress, plugins, and themes.', 'wpvulnerability' )
	);
}
*/
