<?php
/**
 * API Class
 *
 * @package    WordPress
 * @author     David Perez <david@closemarketing.es>
 * @copyright  2022 Closemarketing
 * @version    1.0
 */

defined( 'ABSPATH' ) || exit;

/**
 * API Connector.
 *
 * API connector for Vulnerability.
 *
 * @since 1.0
 */
class API_WPVulnerability {

	/**
	 * Construct of Class
	 */
	public function __construct() {
	}

	public function get( $type, $plugin_slug = '' ) {
		$key = 'wpvulnerability_' . $type;
		if ( ! empty( $plugin_slug ) ) {
			$key .= '_' . $plugin_slug;
		}
		$vulnerability = get_transient( $key );
		if ( ! $vulnerability ) {
			$url = 'https://www.wpvulnerability.net/' . $type;
			if ( ! empty( $plugin_slug ) ) {
				$url .= '/' . $plugin_slug;
			}
			$url .= '/';
			$response = wp_remote_get( $url );
			if ( isset( $response['response']['code'] ) && 200 === $response['response']['code'] ) {
				$body = wp_remote_retrieve_body( $response );
				set_transient( $key, $body, HOUR_IN_SECONDS * 24 );
			}
		}
		return json_decode( $vulnerability, true );
	}
}

$api_wpvulnerability = new API_WPVulnerability();
